[gd_scene load_steps=17 format=2]

[ext_resource path="res://environment/grid_tilemap.tscn" type="PackedScene" id=1]
[ext_resource path="res://hud/hud.tscn" type="PackedScene" id=2]
[ext_resource path="res://levels/level1.gd" type="Script" id=3]
[ext_resource path="res://environment/tile.png" type="Texture" id=4]
[ext_resource path="res://player/player.tscn" type="PackedScene" id=5]
[ext_resource path="res://enemies/basic_enemy.tscn" type="PackedScene" id=6]
[ext_resource path="res://enemies/group_path.tscn" type="PackedScene" id=7]
[ext_resource path="res://enemies/enemy_group.tscn" type="PackedScene" id=8]

[sub_resource type="Shader" id=9]
code = "shader_type canvas_item;

/* GLES2-friendly soft glow */
uniform float radius_px : hint_range(0.0, 24.0) = 4.0;  // blur radius in pixels
uniform float strength  : hint_range(0.0, 4.0)  = 1.2;  // how strong the glow
uniform int   quality   = 1;  // 1 = 9 taps, 2 = 17 taps

void fragment() {
    vec4 base = texture(TEXTURE, UV);

    // pre-multiplied samples to avoid color bleeding from transparent borders
    vec3 acc = base.rgb * base.a;
    float w  = base.a;

    vec2 texel = TEXTURE_PIXEL_SIZE * max(radius_px, 0.0);

    // 8-neighbour ring
    vec2 o1 = vec2(texel.x, 0.0);
    vec2 o2 = vec2(0.0, texel.y);
    vec2 o3 = vec2(texel.x, texel.y);

    vec4 s;

    s = texture(TEXTURE, UV + o1); acc += s.rgb * s.a; w += s.a;
    s = texture(TEXTURE, UV - o1); acc += s.rgb * s.a; w += s.a;
    s = texture(TEXTURE, UV + o2); acc += s.rgb * s.a; w += s.a;
    s = texture(TEXTURE, UV - o2); acc += s.rgb * s.a; w += s.a;
    s = texture(TEXTURE, UV + o3); acc += s.rgb * s.a; w += s.a;
    s = texture(TEXTURE, UV - o3); acc += s.rgb * s.a; w += s.a;
    s = texture(TEXTURE, UV + vec2(o3.x, -o3.y)); acc += s.rgb * s.a; w += s.a;
    s = texture(TEXTURE, UV + vec2(-o3.x, o3.y)); acc += s.rgb * s.a; w += s.a;

    if (quality >= 2) {
        // second ring, farther out
        vec2 r2 = texel * 2.5;
        vec2 d1 = vec2(r2.x, 0.0);
        vec2 d2 = vec2(0.0, r2.y);
        vec2 d3 = vec2(r2.x, r2.y);

        s = texture(TEXTURE, UV + d1); acc += s.rgb * s.a; w += s.a;
        s = texture(TEXTURE, UV - d1); acc += s.rgb * s.a; w += s.a;
        s = texture(TEXTURE, UV + d2); acc += s.rgb * s.a; w += s.a;
        s = texture(TEXTURE, UV - d2); acc += s.rgb * s.a; w += s.a;
        s = texture(TEXTURE, UV + d3); acc += s.rgb * s.a; w += s.a;
        s = texture(TEXTURE, UV - d3); acc += s.rgb * s.a; w += s.a;
        s = texture(TEXTURE, UV + vec2(d3.x, -d3.y)); acc += s.rgb * s.a; w += s.a;
        s = texture(TEXTURE, UV + vec2(-d3.x, d3.y)); acc += s.rgb * s.a; w += s.a;
    }

    vec3 blur = acc / max(w, 1e-4);          // blurred color of the sprite
    vec3 out_rgb = clamp(base.rgb + blur * strength, 0.0, 1.0);

    COLOR = vec4(out_rgb, base.a);           // keep original alpha
}
"

[sub_resource type="ShaderMaterial" id=6]
shader = SubResource( 9 )
shader_param/radius_px = 8.752
shader_param/strength = 0.606
shader_param/quality = 1

[sub_resource type="ShaderMaterial" id=8]

[sub_resource type="ConvexPolygonShape2D" id=10]
points = PoolVector2Array( 32, 32, 0, 32, 0, 0, 32, 0 )

[sub_resource type="ConvexPolygonShape2D" id=2]
points = PoolVector2Array( 32, 32, 0, 32, 0, 0, 32, 0 )

[sub_resource type="ConvexPolygonShape2D" id=3]
points = PoolVector2Array( 32, 32, 0, 32, 0, 0, 32, 0 )

[sub_resource type="TileSet" id=4]
0/name = "blue_tile"
0/texture = ExtResource( 4 )
0/tex_offset = Vector2( 0, 0 )
0/material = SubResource( 8 )
0/modulate = Color( 1, 1, 1, 1 )
0/region = Rect2( 0, 0, 32, 32 )
0/tile_mode = 0
0/occluder_offset = Vector2( 0, 0 )
0/navigation_offset = Vector2( 0, 0 )
0/shape_offset = Vector2( 0, 0 )
0/shape_transform = Transform2D( 1, 0, 0, 1, 0, 0 )
0/shape = SubResource( 10 )
0/shape_one_way = false
0/shape_one_way_margin = 1.0
0/shapes = [ {
"autotile_coord": Vector2( 0, 0 ),
"one_way": false,
"one_way_margin": 1.0,
"shape": SubResource( 10 ),
"shape_transform": Transform2D( 1, 0, 0, 1, 0, 0 )
} ]
0/z_index = 0
1/name = "purple_tile"
1/texture = ExtResource( 4 )
1/tex_offset = Vector2( 0, 0 )
1/modulate = Color( 1, 1, 1, 1 )
1/region = Rect2( 32, 0, 32, 32 )
1/tile_mode = 0
1/occluder_offset = Vector2( 0, 0 )
1/navigation_offset = Vector2( 0, 0 )
1/shape_offset = Vector2( 0, 0 )
1/shape_transform = Transform2D( 1, 0, 0, 1, 0, 0 )
1/shape = SubResource( 2 )
1/shape_one_way = false
1/shape_one_way_margin = 1.0
1/shapes = [ {
"autotile_coord": Vector2( 0, 0 ),
"one_way": false,
"one_way_margin": 1.0,
"shape": SubResource( 2 ),
"shape_transform": Transform2D( 1, 0, 0, 1, 0, 0 )
} ]
1/z_index = 0
2/name = "pink_tile"
2/texture = ExtResource( 4 )
2/tex_offset = Vector2( 0, 0 )
2/modulate = Color( 1, 1, 1, 1 )
2/region = Rect2( 64, 0, 32, 32 )
2/tile_mode = 0
2/occluder_offset = Vector2( 0, 0 )
2/navigation_offset = Vector2( 0, 0 )
2/shape_offset = Vector2( 0, 0 )
2/shape_transform = Transform2D( 1, 0, 0, 1, 0, 0 )
2/shape = SubResource( 3 )
2/shape_one_way = false
2/shape_one_way_margin = 1.0
2/shapes = [ {
"autotile_coord": Vector2( 0, 0 ),
"one_way": false,
"one_way_margin": 1.0,
"shape": SubResource( 3 ),
"shape_transform": Transform2D( 1, 0, 0, 1, 0, 0 )
} ]
2/z_index = 0

[sub_resource type="Curve2D" id=1]
_data = {
"points": PoolVector2Array( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1920, 0, 0, 0, 0, 0, 2400, -16, 0, 0, 0, 0, 2584, -88, 0, 0, 0, 0, 2768, -160, 0, 0, 0, 0, 3104, -248, 0, 0, 0, 0, 3312, -288, 0, 0, 0, 0, 3480, -312, 0, 0, 0, 0, 3640, -416, 0, 0, 0, 0, 3944, -584, 0, 0, 0, 0, 4192, -744, 0, 0, 0, 0, 4336, -864, 0, 0, 0, 0, 4872, -976, 0, 0, 0, 0, 5208, -1072, 0, 0, 0, 0, 5776, -1088, 0, 0, 0, 0, 6088, -896, 0, 0, 0, 0, 6384, -560, 0, 0, 0, 0, 6520, -256, 0, 0, 0, 0, 6824, 232, 0, 0, 0, 0, 6920, 304, 0, 0, 0, 0, 7192, 304, 0, 0, 0, 0, 7352, 192, 0, 0, 0, 0, 7872, -88, 0, 0, 0, 0, 8192, -264 )
}

[node name="Level1" type="Node2D"]
script = ExtResource( 3 )

[node name="Node2D" type="Node2D" parent="."]

[node name="PlayerBase" type="Node2D" parent="Node2D"]

[node name="Player" parent="Node2D/PlayerBase" instance=ExtResource( 5 )]
position = Vector2( -360, 0 )

[node name="HUDBase" type="CanvasLayer" parent="Node2D/PlayerBase"]

[node name="HUD" parent="Node2D/PlayerBase/HUDBase" instance=ExtResource( 2 )]

[node name="Camera2D" type="Camera2D" parent="Node2D/PlayerBase"]
current = true

[node name="EnemiesBase" type="Node2D" parent="."]

[node name="Group1" parent="EnemiesBase" instance=ExtResource( 8 )]
position = Vector2( 2056, 8 )

[node name="BasicEnemy" parent="EnemiesBase/Group1" instance=ExtResource( 6 )]
position = Vector2( -152, -32 )

[node name="BasicEnemy2" parent="EnemiesBase/Group1" instance=ExtResource( 6 )]
position = Vector2( 0, -104 )

[node name="BasicEnemy3" parent="EnemiesBase/Group1" instance=ExtResource( 6 )]
position = Vector2( 0, 40 )

[node name="GroupPath1" parent="EnemiesBase" instance=ExtResource( 7 )]
position = Vector2( 2056, 8 )

[node name="EnvironmentBase" type="Node2D" parent="."]
z_index = -1

[node name="GridTilemap" parent="EnvironmentBase" instance=ExtResource( 1 )]
material = SubResource( 6 )
tile_set = SubResource( 4 )
tile_data = PoolIntArray( -2555713, 0, 0, -2555712, 0, 0, -2555711, 0, 0, -2490179, 0, 0, -2490178, 0, 0, -2490175, 0, 0, -2490174, 0, 0, -2424646, 0, 0, -2424645, 0, 0, -2424644, 0, 0, -2424638, 0, 0, -2424637, 0, 0, -2359112, 0, 0, -2359111, 0, 0, -2359101, 0, 0, -2359100, 0, 0, -2359099, 0, 0, -2293579, 0, 0, -2293578, 0, 0, -2293577, 0, 0, -2293576, 0, 0, -2293563, 0, 0, -2293562, 0, 0, -2293561, 0, 0, -2293560, 0, 0, -2293559, 0, 0, -2293558, 0, 0, -2293557, 0, 0, -2293556, 0, 0, -2228053, 0, 0, -2228052, 0, 0, -2228051, 0, 0, -2228050, 0, 0, -2228049, 0, 0, -2228048, 0, 0, -2228047, 0, 0, -2228046, 0, 0, -2228045, 0, 0, -2228044, 0, 0, -2228043, 0, 0, -2228020, 0, 0, -2228019, 0, 0, -2228018, 0, 0, -2228017, 0, 0, -2162521, 0, 0, -2162520, 0, 0, -2162519, 0, 0, -2162518, 0, 0, -2162517, 0, 0, -2162481, 0, 0, -2162480, 0, 0, -2162479, 0, 0, -2096989, 0, 0, -2096988, 0, 0, -2096987, 0, 0, -2096986, 0, 0, -2096943, 0, 0, -2096942, 0, 0, -2031458, 0, 0, -2031457, 0, 0, -2031456, 0, 0, -2031455, 0, 0, -2031454, 0, 0, -2031453, 0, 0, -2031405, 0, 0, -1965925, 0, 0, -1965924, 0, 0, -1965923, 0, 0, -1965922, 0, 0, -1965919, 0, 0, -1965869, 0, 0, -1965868, 0, 0, -1900391, 0, 0, -1900390, 0, 0, -1900389, 0, 0, -1900331, 0, 0, -1834859, 0, 0, -1834858, 0, 0, -1834857, 0, 0, -1834856, 0, 0, -1834794, 0, 0, -1834793, 0, 0, -1769325, 0, 0, -1769324, 0, 0, -1769323, 0, 0, -1769257, 0, 0, -1769256, 0, 0, -1703792, 0, 0, -1703791, 0, 0, -1703790, 0, 0, -1703720, 0, 0, -1703719, 0, 0, -1638259, 0, 0, -1638258, 0, 0, -1638257, 0, 0, -1638256, 0, 0, -1638182, 0, 0, -1572727, 0, 0, -1572726, 0, 0, -1572725, 0, 0, -1572724, 0, 0, -1572723, 0, 0, -1572645, 0, 0, -1507193, 0, 0, -1507192, 0, 0, -1507108, 0, 0, -1441658, 0, 0, -1441657, 0, 0, -1441572, 0, 0, -1376123, 0, 0, -1376036, 0, 0, -1310588, 0, 0, -1310499, 0, 0, -1245052, 0, 0, -1244962, 0, 0, -1179517, 0, 0, -1179425, 0, 0, -1179424, 0, 0, -1113983, 0, 0, -1113982, 0, 0, -1113888, 0, 0, -1113887, 0, 0, -1113886, 0, 0, -1048450, 0, 0, -1048449, 0, 0, -1048448, 0, 0, -1048350, 0, 0, -982918, 0, 0, -982917, 0, 0, -982916, 0, 0, -982915, 0, 0, -982813, 0, 0, -917387, 0, 0, -917386, 0, 0, -917385, 0, 0, -917384, 0, 0, -917383, 0, 0, -917382, 0, 0, -917277, 0, 0, -917276, 0, 0, -851853, 0, 0, -851852, 0, 0, -851740, 0, 0, -786318, 0, 0, -786317, 0, 0, -786204, 0, 0, -720784, 0, 0, -720783, 0, 0, -720667, 0, 0, -655250, 0, 0, -655249, 0, 0, -655131, 0, 0, -655130, 0, 0, -655098, 0, 0, -655097, 0, 0, -655096, 0, 0, -589715, 0, 0, -589714, 0, 0, -589594, 0, 0, -589593, 0, 0, -589563, 0, 0, -589562, 0, 0, -524180, 0, 0, -524057, 0, 0, -524056, 0, 0, -524029, 0, 0, -524028, 0, 0, -524027, 0, 0, -458653, 0, 0, -458652, 0, 0, -458649, 0, 0, -458648, 0, 0, -458647, 0, 0, -458646, 0, 0, -458645, 0, 0, -458520, 0, 0, -458494, 0, 0, -458493, 0, 0, -393119, 0, 0, -393118, 0, 0, -393116, 0, 0, -393115, 0, 0, -393114, 0, 0, -393113, 0, 0, -392984, 0, 0, -392983, 0, 0, -392970, 0, 0, -392968, 0, 0, -392967, 0, 0, -392966, 0, 0, -392965, 0, 0, -392964, 0, 0, -392963, 0, 0, -392962, 0, 0, -392961, 0, 0, -392960, 0, 0, -392959, 0, 0, -327585, 0, 0, -327584, 0, 0, -327583, 0, 0, -327447, 0, 0, -327434, 0, 0, -327433, 0, 0, -327432, 0, 0, -262051, 0, 0, -262050, 0, 0, -262049, 0, 0, -261910, 0, 0, -261900, 0, 0, -261899, 0, 0, -261898, 0, 0, -196517, 0, 0, -196516, 0, 0, -196515, 0, 0, -196374, 0, 0, -196373, 0, 0, -196372, 0, 0, -196366, 0, 0, -196365, 0, 0, -196364, 0, 0, -131003, 0, 0, -131002, 0, 0, -131001, 0, 0, -131000, 0, 0, -130984, 0, 0, -130983, 0, 0, -130982, 0, 0, -130981, 0, 0, -130837, 0, 0, -130836, 0, 0, -130831, 0, 0, -130830, 0, 0, -130829, 0, 0, -130828, 0, 0, -65524, 0, 0, -65523, 0, 0, -65522, 0, 0, -65521, 0, 0, -65520, 0, 0, -65499, 0, 0, -65498, 0, 0, -65497, 0, 0, -65471, 0, 0, -65470, 0, 0, -65469, 0, 0, -65468, 0, 0, -65464, 0, 0, -65463, 0, 0, -65462, 0, 0, -65461, 0, 0, -65460, 0, 0, -65459, 0, 0, -65458, 0, 0, -65457, 0, 0, -65456, 0, 0, -65455, 0, 0, -65454, 0, 0, -65453, 0, 0, -65452, 0, 0, -65451, 0, 0, -65450, 0, 0, -65449, 0, 0, -65301, 0, 0, -65300, 0, 0, -65296, 0, 0, -65295, 0, 0, -65294, 0, 0, -65293, 0, 0, 5, 0, 0, 6, 0, 0, 7, 0, 0, 8, 0, 0, 9, 0, 0, 10, 0, 0, 11, 0, 0, 16, 0, 0, 17, 0, 0, 32, 0, 0, 33, 0, 0, 34, 0, 0, 35, 0, 0, 36, 0, 0, 40, 0, 0, 41, 0, 0, 42, 0, 0, 43, 0, 0, 44, 0, 0, 45, 0, 0, 46, 0, 0, 47, 0, 0, 48, 0, 0, 49, 0, 0, 50, 0, 0, 51, 0, 0, 59, 0, 0, 61, 0, 0, 62, 0, 0, 63, 0, 0, 64, 0, 0, 65, 0, 0, 236, 0, 0, 239, 0, 0, 240, 0, 0, 241, 0, 0, 242, 0, 0, 65537, 0, 0, 65538, 0, 0, 65539, 0, 0, 65540, 0, 0, 65553, 0, 0, 65554, 0, 0, 65565, 0, 0, 65566, 0, 0, 65567, 0, 0, 65588, 0, 0, 65589, 0, 0, 65590, 0, 0, 65591, 0, 0, 65592, 0, 0, 65593, 0, 0, 65594, 0, 0, 65596, 0, 0, 65597, 0, 0, 65772, 0, 0, 65775, 0, 0, 65776, 0, 0, 65777, 0, 0, 65778, 0, 0, 131091, 0, 0, 131092, 0, 0, 131093, 0, 0, 131098, 0, 0, 131099, 0, 0, 131100, 0, 0, 131101, 0, 0, 131308, 0, 0, 131309, 0, 0, 131311, 0, 0, 131312, 0, 0, 131313, 0, 0, 196629, 0, 0, 196630, 0, 0, 196631, 0, 0, 196632, 0, 0, 196633, 0, 0, 196845, 0, 0, 196847, 0, 0, 196848, 0, 0, 196849, 0, 0, 262382, 0, 0, 262383, 0, 0, 262384, 0, 0, 327918, 0, 0, 327919, 0, 0, 327920, 0, 0, 393454, 0, 0, 393455, 0, 0, 458990, 0, 0, 458991, 0, 0, 524527, 0, 0, 590063, 0, 0, 655392, 0, 0, 655393, 0, 0, 720925, 0, 0, 720926, 0, 0, 720927, 0, 0, 720929, 0, 0, 720930, 0, 0, 720931, 0, 0, 720932, 0, 0, 786458, 0, 0, 786459, 0, 0, 786460, 0, 0, 851992, 0, 0, 851993, 0, 0, 917526, 0, 0, 917527, 0, 0, 983058, 0, 0, 983059, 0, 0, 983060, 0, 0, 983061, 0, 0, 1048592, 0, 0, 1048593, 0, 0, 1114119, 0, 0, 1114120, 0, 0, 1114121, 0, 0, 1114122, 0, 0, 1114123, 0, 0, 1114124, 0, 0, 1114125, 0, 0, 1114126, 0, 0, 1114127, 0, 0 )

[node name="Path2D" type="Path2D" parent="."]
curve = SubResource( 1 )

[node name="PathFollow2D" type="PathFollow2D" parent="Path2D"]
rotate = false
loop = false
